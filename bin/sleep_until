#!/usr/bin/env bash

sec=$(($(date -d "$*" +%s 2>/dev/null || date -d "tomorrow $*" +%s) - $(date +%s)))
if [[ ${sec} -lt 0 ]]; then
    echo "Invalid argument" >&2
    exit 1
fi

echo "Start time: $(date)" >&2
echo "Sleep time: $((sec / 3600))h $(((sec % 3600) / 60))m $((sec % 60))s" >&2

while [[ ${sec} -gt 0 ]]; do
    current_time=$(date +%s)
    sec=$(($(($(date -d "$*" +%s 2>/dev/null || date -d "tomorrow $*" +%s))) - current_time))
    if [[ ${sec} -le 0 ]]; then
        break
    fi
    printf "Remaining: %02dh %02dm %02ds\r" $((sec / 3600)) $(((sec % 3600) / 60)) $((sec % 60))
    sleep 1
done

echo -e "\nTime's up!"
