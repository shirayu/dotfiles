#!/usr/bin/env bash

set -euo pipefail
set -x

exists() {
    command -v "$1" >/dev/null 2>&1
}

if exists claude; then
    echo "Updating claude..."
    claude update
fi

if exists mise; then
    echo "Updating mise..."
    mise cache clear
    mise self-update -y
    MISE_USE_VERSIONS_HOST=false mise upgrade
    mise reshim
fi

if exists pip; then
    echo "Updating pip packages..."
    pip list -o --format json \
        | python -c 'import sys, json; [print(item["name"]) for item in json.loads(sys.stdin.read())]' \
        | xargs --no-run-if-empty -t pip install -U
fi

if exists uv; then
    echo "Updating uv tools..."
    export UV_HTTP_TIMEOUT=${UV_HTTP_TIMEOUT:-600}
    uv tool upgrade --all
fi

if exists npm; then
    echo "Updating npm global packages..."
    npm -g upgrade
    npm -g uninstall corepack || true
fi

if exists pnpm; then
    echo "Updating pnpm global packages..."
    pnpm -g up --latest
fi

echo "All updates completed!"
